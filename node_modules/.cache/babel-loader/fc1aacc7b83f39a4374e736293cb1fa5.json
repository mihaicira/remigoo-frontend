{"ast":null,"code":"import _regeneratorRuntime from\"D:/react/remigoo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/react/remigoo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/react/remigoo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import\"./AccountDataSection.css\";import{useState,useEffect}from'react';import Button from\"../../Button/Button\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var UserForm=function UserForm(props){useEffect(function(){// console.log(\"userform:\",props)\nconsole.log(\"@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\");});return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"form\",{className:\"account-form\",onSubmit:props.event,children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Old username: \",props.name]}),/*#__PURE__*/_jsx(\"label\",{children:\"New username:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",required:true}),/*#__PURE__*/_jsx(Button,{text:\"Change username\"})]})});};var EmailForm=function EmailForm(props){return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"form\",{className:\"account-form\",onSubmit:props.event,children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Old email: \",props.email]}),/*#__PURE__*/_jsx(\"label\",{children:\"New email:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",required:true}),/*#__PURE__*/_jsx(Button,{text:\"Change email\"})]})});};var PasswordForm=function PasswordForm(props){return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"form\",{className:\"account-form\",onSubmit:props.event,children:[/*#__PURE__*/_jsx(\"label\",{children:\"Old password:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",required:true}),/*#__PURE__*/_jsx(\"label\",{children:\"New password:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",required:true}),/*#__PURE__*/_jsx(Button,{text:\"Change password\"})]})});};function AccountDataSection(props){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),activeForm=_useState2[0],setActiveForm=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),submittedStatusText=_useState4[0],setSubmittedStatusText=_useState4[1];var submitUsernameForm=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var new_username,auth_token,response,data,storage;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();new_username=e.target[0].value;auth_token=JSON.parse(localStorage.getItem(\"loginStatus\")).userData.token;_context.next=5;return fetch(\"http://localhost:3000/change-name?id=\".concat(3,\"&name=\",new_username,\"&token=\").concat(auth_token));case 5:response=_context.sent;_context.next=8;return response.json();case 8:data=_context.sent;setActiveForm(\"submitted\");setSubmittedStatusText(data.error?\"There has been an error.\":\"Your username has been changed\");storage=JSON.parse(localStorage.getItem(\"loginStatus\"));storage.userData.userName=new_username;localStorage.setItem(\"loginStatus\",JSON.stringify(storage));props.refreshUser(JSON.parse(localStorage.getItem(\"loginStatus\")).userData.userEmail);case 15:case\"end\":return _context.stop();}}},_callee);}));return function submitUsernameForm(_x){return _ref.apply(this,arguments);};}();var submitEmailForm=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var new_email,auth_token,response,data,storage;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();new_email=e.target[0].value;auth_token=JSON.parse(localStorage.getItem(\"loginStatus\")).userData.token;_context2.next=5;return fetch(\"http://localhost:3000/change-email?id=\".concat(props.id,\"&email_address=\").concat(new_email,\"&token=\").concat(auth_token));case 5:response=_context2.sent;_context2.next=8;return response.json();case 8:data=_context2.sent;setActiveForm(\"submitted\");setSubmittedStatusText(data.error?\"There has been an error.\":\"Your email has been changed\");storage=JSON.parse(localStorage.getItem(\"loginStatus\"));storage.userData.userEmail=new_email;localStorage.setItem(\"loginStatus\",JSON.stringify(storage));props.refreshUser(new_email);case 15:case\"end\":return _context2.stop();}}},_callee2);}));return function submitEmailForm(_x2){return _ref2.apply(this,arguments);};}();var submitPasswordForm=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){var old_pass,new_pass,auth_token,response,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:e.preventDefault();old_pass=e.target[0].value;new_pass=e.target[1].value;auth_token=JSON.parse(localStorage.getItem(\"loginStatus\")).userData.token;_context3.next=6;return fetch(\"http://localhost:3000/change-password?id=\".concat(props.id,\"&old_password=\").concat(old_pass,\"&new_password=\").concat(new_pass,\"&token=\").concat(auth_token));case 6:response=_context3.sent;_context3.next=9;return response.json();case 9:data=_context3.sent;setActiveForm(\"submitted\");setSubmittedStatusText(data.error?data.content:\"Your password has been changed\");case 12:case\"end\":return _context3.stop();}}},_callee3);}));return function submitPasswordForm(_x3){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"account-section ticket-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"account-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){setActiveForm(\"user\");},children:\"Change your username\"}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){setActiveForm(\"email\");},children:\"Change your email adress\"}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){setActiveForm(\"pass\");},children:\"Change your password\"})]}),activeForm===\"user\"&&/*#__PURE__*/_jsx(UserForm,{event:submitUsernameForm,name:props.name}),activeForm===\"email\"&&/*#__PURE__*/_jsx(EmailForm,{event:submitEmailForm,email:props.email}),activeForm===\"pass\"&&/*#__PURE__*/_jsx(PasswordForm,{event:submitPasswordForm}),activeForm===\"submitted\"&&/*#__PURE__*/_jsx(\"div\",{className:\"account-submitted\",children:/*#__PURE__*/_jsx(\"p\",{children:submittedStatusText})})]});}export default AccountDataSection;","map":{"version":3,"sources":["D:/react/remigoo/src/Components/PageProfile/AccountDataSection/AccountDataSection.js"],"names":["useState","useEffect","Button","UserForm","props","console","log","event","name","EmailForm","email","PasswordForm","AccountDataSection","activeForm","setActiveForm","submittedStatusText","setSubmittedStatusText","submitUsernameForm","e","preventDefault","new_username","target","value","auth_token","JSON","parse","localStorage","getItem","userData","token","fetch","response","json","data","error","storage","userName","setItem","stringify","refreshUser","userEmail","submitEmailForm","new_email","id","submitPasswordForm","old_pass","new_pass","content"],"mappings":"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","sourcesContent":["import \"./AccountDataSection.css\";\r\nimport {useState,useEffect} from  'react';\r\nimport Button from \"../../Button/Button\";\r\n\r\nconst UserForm = (props) =>{\r\n\r\n    useEffect(()=>{\r\n        // console.log(\"userform:\",props)\r\n        console.log(\"@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\")\r\n    })\r\n\r\n    return(<>\r\n        <form className=\"account-form\" onSubmit={props.event}>\r\n            <label>Old username: {props.name}</label>\r\n            <label>New username:</label>\r\n            <input type=\"text\" required/>\r\n            <Button text=\"Change username\"/>\r\n        </form>\r\n        </>)\r\n}\r\n\r\nconst EmailForm = (props) =>{\r\n    return(<>\r\n        <form className=\"account-form\" onSubmit={props.event}>\r\n            <label>Old email: {props.email}</label>\r\n            <label>New email:</label>\r\n            <input type=\"text\" required/>\r\n            <Button text=\"Change email\"/>\r\n        </form>\r\n    </>)\r\n}\r\n\r\nconst PasswordForm = (props) =>{\r\n    return(<>\r\n        <form className=\"account-form\" onSubmit={props.event}>\r\n            <label>Old password:</label>\r\n            <input type=\"text\" required/>\r\n            <label>New password:</label>\r\n            <input type=\"text\" required/>\r\n            <Button text=\"Change password\"/>\r\n        </form>\r\n    </>)\r\n}\r\n\r\nfunction AccountDataSection(props) {\r\n    const [activeForm,setActiveForm] = useState(\"\")\r\n    const [submittedStatusText,setSubmittedStatusText] = useState(\"\")\r\n\r\n    const submitUsernameForm = async (e) =>{\r\n        e.preventDefault()\r\n        let new_username = e.target[0].value\r\n        let auth_token = JSON.parse(localStorage.getItem(\"loginStatus\")).userData.token\r\n\r\n        const response = await fetch(`http://localhost:3000/change-name?id=${3}&name=${new_username}&token=${auth_token}`)\r\n        const data = await response.json()\r\n\r\n\r\n        setActiveForm(\"submitted\")\r\n\r\n        setSubmittedStatusText(data.error ? \"There has been an error.\" : \"Your username has been changed\")\r\n\r\n\r\n        let storage = JSON.parse(localStorage.getItem(\"loginStatus\"))\r\n        storage.userData.userName = new_username\r\n        localStorage.setItem(\"loginStatus\",JSON.stringify(storage))\r\n\r\n        props.refreshUser(JSON.parse(localStorage.getItem(\"loginStatus\")).userData.userEmail)\r\n    }\r\n\r\n    const submitEmailForm = async (e) =>{\r\n        e.preventDefault()\r\n        let new_email = e.target[0].value\r\n        let auth_token = JSON.parse(localStorage.getItem(\"loginStatus\")).userData.token\r\n\r\n        const response = await fetch(`http://localhost:3000/change-email?id=${props.id}&email_address=${new_email}&token=${auth_token}`)\r\n        const data = await response.json()\r\n\r\n        setActiveForm(\"submitted\")\r\n        setSubmittedStatusText(data.error ? \"There has been an error.\" : \"Your email has been changed\")\r\n\r\n\r\n        let storage = JSON.parse(localStorage.getItem(\"loginStatus\"))\r\n        storage.userData.userEmail = new_email\r\n        localStorage.setItem(\"loginStatus\",JSON.stringify(storage))\r\n\r\n        props.refreshUser(new_email)\r\n    }\r\n\r\n    const submitPasswordForm = async (e) =>{\r\n        e.preventDefault()\r\n        let old_pass = e.target[0].value\r\n        let new_pass = e.target[1].value\r\n        let auth_token = JSON.parse(localStorage.getItem(\"loginStatus\")).userData.token\r\n\r\n        const response = await fetch(`http://localhost:3000/change-password?id=${props.id}&old_password=${old_pass}&new_password=${new_pass}&token=${auth_token}`)\r\n        const data = await response.json()\r\n\r\n        setActiveForm(\"submitted\")\r\n        setSubmittedStatusText(data.error ? data.content : \"Your password has been changed\")\r\n\r\n    }\r\n\r\n    return (\r\n        <div className=\"account-section ticket-section\">\r\n            <div className=\"account-buttons\">\r\n                <button onClick={()=>{setActiveForm(\"user\")}}>Change your username</button>\r\n                <button onClick={()=>{setActiveForm(\"email\")}}>Change your email adress</button>\r\n                <button onClick={()=>{setActiveForm(\"pass\")}}>Change your password</button>\r\n            </div>\r\n\r\n            {activeForm===\"user\" && <UserForm event={submitUsernameForm} name={props.name}/>}\r\n\r\n            {activeForm===\"email\" && <EmailForm event={submitEmailForm} email={props.email}/>}\r\n\r\n            {activeForm===\"pass\" && <PasswordForm event={submitPasswordForm}/>}\r\n\r\n            {activeForm===\"submitted\" &&\r\n            <div className=\"account-submitted\" >\r\n                <p>{submittedStatusText}</p>\r\n            </div>}\r\n\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default AccountDataSection;\r\n"]},"metadata":{},"sourceType":"module"}